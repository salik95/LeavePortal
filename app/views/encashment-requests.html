{% extends 'base.html' %}

{% block title %}Encashment of Leaves{% endblock %}

{% block body %}

{% if current_user.role == 'HR Manager' %}
{% set approval_field = 'hr_approval' %}
{% elif current_user.role == 'General Manager' %}
{% set approval_field = 'gm_approval' %}
{% else %}
{% set approval_field = 'manager_approval' %}
{% endif %}

<main id="encashment">

  <div class="row">
    <div class="col s12 l7 center">
      <div class="card encashment-requests text-center">
        <p class="card-title"><i class="material-icons">event</i> <span>Encashment Requests</span></p>
        <ul class="collapsible padded" data-collapsible="accordion">

          {% for item in data.requests.pending + data.requests.responded %}
          
          {% if item[1][approval_field] is none %}
          {% set status = 'pending' %}
          {% else %}
          {% set status = item[1][approval_field] %}
          {% endif %}

          <li class="collection-item {{status|lower}}">
            <div class="collapsible-header">
              <div class="name">
                {{ item[0].first_name }} {{ item[0].last_name }}
              </div>
              <p class="date"><i class="material-icons">date_range</i> <span>{{item[1].time_stamp.strftime('%b %d, %Y')}}</span></p>
              <div class="status"></div>
            </div>

            <div class="collapsible-body">  

              <div class="row">
                <p class="center light">{{item[0].designation + ', ' + item[0].department}}</p>
              </div>
  
              {% if status == 'pending' %}
              <div class="row">
                <form data-resource="encashment" method="PUT">

                  {% include 'components/loading.html' %}
                  <div class="notice"></div>

                  <input type="hidden" name="id" value={{item[1].id}}>

                  <div class="row">
                    <p class="col s6 text-center">
                      <input name="approval" type="radio" id="approve-{{item[1].id}}" value="Approved" required />
                      <label for="approve-{{item[1].id}}">Approve</label>
                    </p>
                    <p class="col s6 text-center">
                      <input name="approval" type="radio" id="decline-{{item[1].id}}" value="Unapproved" required />
                      <label for="decline-{{item[1].id}}">Decline</label>
                    </p>
                  </div>

                  <p class="small center"><strong>Note:</strong> This action is irreversible</p>
                  <br>

                  <div class="center">
                    <button type="submit" class="waves-effect waves-light btn round center">Confirm</button>
                  </div> 
                </form> 
              </div>
              {% endif %}

            </div>
          </li>
          {% endfor%}
        </ul>
      </div>     
    </div>
  </div>
  
</main>

{% endblock %}